---
title: About-Django
tags:
  - IT
  - Python
  - Django
  - Web-development
urlname: About-Django
date: 2020-04-21 22:47:15
---


从学习 Django 开始学习 Web 开发。

<!-- more -->

To do list

- [] 处理流程图
- [] url
- [] 视图
- [] 表单
- [] 模型
- [] 模板
- [] 缓存
- [] 数据库
- [] 身份验证
- [] workflow
- [] 项目组织
- [] deploy
- [] 测试

## URL

简洁、优雅的 URL 设计。
URL 路径表达式到 Python 视图函数之间的映射

### 处理请求的流程

1. 从 `setting` 中找到 `ROOT_URLCONF`
2. 进入 `ROOT_URLCONF` 的 URL 模块中（一般为 `urls.py`）中找到 `urlpatterns`，`urlpatterns` 是一个序列，其值为 `django.urls.path()` 和/或 `django.urls.re_path()` 的实例。
3. 在上述序列里匹配，知道匹配到第一个 URL，进入视图函数
4. 没有则进入异常

### `URL` 异常处理


## 视图 - view

### 函数视图 - FBV

### 类视图 - CBV

#### 资源

- 一个关于 [CBV](http://ccbv.co.uk/) 很赞的网站，网站里列出了 Django 提供的所有类视图，在单个类视图网页里列出了视图类的属性及方法以及它们的继承关系。
- 一个关于 [Class-based Views](https://django-advanced-training.readthedocs.io/en/latest/features/class-based-views/) 的介绍

## 表单

## 模型

每个模型被表示为 `django.db.models.Model` 类的子类，每个模型有许多类变量，它们都表示模型里的一个数据库字段（Field）。

### 字段

模型中的每个字段应确定适当的 Field 类的实例，以确定存储数据的列类型、生成表单时的部件以及表单验证


#### 字段类型

```python
AutoField # 做主键用，一般不需要直接使用
SmallAutoField # 1 to 32767
BigAutoField # 与上面的类似，1 to 9223372036854775807
UUIDField # 通用唯一识别码

IntegerField # 整数，-2147483648 to 2147483647
BigIntegerField # 与上面类似，-9223372036854775808 to 9223372036854775807，from 里是 textinput
SmallIntegerField # -32768 to 32767
PositiveIntegerField # 0 to 2147483647
PositiveSmallIntegerField # 0 to 32767
DecimalField # 十进制数，两个必须的参数，小数（decimal places）的位数和位数（必须大于小数的位数）
FloatField # 与上述类似，但是它对应的是 Python 中的 float

BooleanField # 真真假假
NullBooleanField # 要被放弃的字段，不要用

CharField # 字符串
TextField # 文本框
EmailField # 电子邮件地址
SlugField

DateField # 日期，对应的是 Python 中的 datetime.date
DateTimeField # 对应的是 Python 中的 datetime.datetime
DurationField # 对应的是 Python 中的 datetime.timedelta，需要再实验下用法
TimeField # 对应的是 Python 中的 datetime.time

FileField # 文件上传字段，两个参数：upload_to（注意值可以是个函数）与 max_length（默认100），
FilePathField
ImageField # 继承自 FileField，可验证上传是否为有效图形。结合 Pillow。

GenericIPAddressField # IPv4 或者 IPv6 地址
URLField # 用于 URL 的CharField，默认长度是 200

ForeignKey # 外健，
ManyToManyField # 多对多的关系
OneToOneField
```

#### 字段参数

一般参数，可选

```python
null # 默认 False，database-related，避免在字符串字段中使用，可以选用下一个 blank
blank # 默认 False，validation-related
choices # 两项的元组组成的迭代序列（如 list tuple），元组的第二项是第一项的可读名称，第二项也可以是个二项的元组序列，这样可以分组。
db_column # 指定字段在数据库中的列名，不设置则列名为字段名
db_index # 如果为 True，则将为此字段创建数据库索引。
db_tablespace # 
default # 
editable # 
error_messages # 
help_text # 与窗体小部件一起显示的额外“帮助”文本。 即使表单中没有使用你的字段，这对文档编写也很有用
primary_key # 
unique # 
unique_for_date # 
unique_for_month # 
unique_for_year # 
verbose_name # 字段可读名称
validators # 
```

### Meta options

```python
abstract # 如果 abstract 是 True，那么这个模型将是一个抽象基类。
app_label # 
base_manager_name # 
db_table # 指定表名
db_tablespace # 
default_manager_name # 
default_related_name # 
get_latest_by # 字段名或字段名的列表，通常和时间相关的字段
managed # 
order_with_respect_to # 
ordering # 
permissions # 
default_permissions # 
proxy # 
required_db_features # 
required_db_vendor # 
select_on_save # 
indexes # 
unique_together # 
index_together # 
constraints # 
verbose_name # 
verbose_name_plural # 复数名称
```

一个模型类表示一个数据库表，该类的一个实例表示数据库表中的一个特定记录。在 `database API` 中两步创建一个对象：模型类实例化、调用 `save()` 保存。

### QuerySet API

`QuerySet` 是一个类，可以实现数据库的查询功能，并且查询的结果可迭代、分片，可以链式查询，所以类的很多方法放回的仍然是类本身

#### 类方法

```python
filter(**kwargs) # 返回与查询参数对应的新 QuerySet
exclude(**kwargs) # 与上面相反
```

## 数据库

### 数据库配置

以 PostgreSQL 为例，创建一个叫做 djdb 的数据库，进入数据库：

```shell
$ createdb djdb
$ psql djdb
```

创建用户 `djdbuser`，不设置密码

```sql
djdb=# CREATE USER djdbuser;
```

在 `settings.py` 中设置数据库如下：

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'djdb',
        'USER': 'djdbuser',
        'HOST': '127.0.0.1',
        'PORT': '5432',
    }
```

## 身份验证

Django 自带了一个身份验证系统开箱即用的工具，以处理用户账户、组、权限及基于 cookie 的用户会话。这套系统同时处理身份验证（是否是声称的用户）和授权（用户被允许做什么）。

### 安装

Authentication support is bundled as a Django contrib module in django.contrib.auth. By default, the required configuration is already included in the settings.py generated by django-admin startproject, these consist of two items listed in your INSTALLED_APPS setting:
验证系统在 `django.contrib.auth` 模块中，在 `INSTALLED_APPS` 中，列入下列两个：

```python
'django.contrib.auth',
'django.contrib.contenttypes',
```

中间价 `MIDDLEWARE` 中列入：

```python
'django.contrib.sessions.middleware.SessionMiddleware',
'django.contrib.auth.middleware.AuthenticationMiddleware',
```

设置以后运行 `manage.py migrate` 即可建立用户验证相关的数据库。

### 默认的 Django 验证系统

#### User 对象
